# BigInt Library - Библиотека бесконечных целых чисел на Free Pascal

## Обзор
Реализация длинной арифметики для целых чисел произвольной точности на Free Pascal Compiler.

## Текущее состояние
- **Версия FPC**: 3.2.2
- **Статус**: Все 195 тестов проходят успешно
- **Предупреждения компилятора**: 0

## Основные файлы
- `bigint.pas` - Основной модуль библиотеки (~3585 строк)
- `main.pas` - Файл тестов (~1302 строки)

## Архитектура оптимизации

### Централизованные helper-функции
Библиотека использует набор централизованных функций для оптимизации:

| Функция | Назначение |
|---------|------------|
| `IsSmallBigInt(a)` | Быстрая проверка для оптимизации (Length <= 2) |
| `IsZeroBigInt(a)` | Быстрая проверка на ноль |
| `EnsureCapacity(a, n)` | Гарантия ёмкости буфера без изменения Length |
| `ShrinkToFit(a)` | Уменьшение буфера для экономии памяти |

Для детектирования алиасинга используется прямое сравнение адресов: `@a = @b`

### Fast-path оптимизации
Все основные операции имеют "быстрые пути":
1. **Проверка IsSmallBigInt** - если оба операнда помещаются в Int64
2. **Нативные операции** - использование Int64 арифметики процессора
3. **Полный путь** - только для больших чисел

### Обработка алиасинга
Все операции корректно работают с алиасингом:
- `a := a + b` - временный буфер для результата
- `a := a * a` - вызов оптимизированного BigIntSqr_School
- `a := a + a` - преобразование в сдвиг (a << 1)
- `a := a - a` - немедленный возврат 0

## Алгоритмы

### Сложение/Вычитание - O(n)
- Fast-path для Int64
- Школьный алгоритм для больших чисел
- Оптимизации: a + a → shl, a - a → 0

### Умножение - O(n*m) / O(n^1.585)
- Fast-path для Int64
- Школьное умножение для чисел < 32 разрядов
- Алгоритм Карацубы для больших чисел (порог: 32)
- Оптимизированное возведение в квадрат (BigIntSqr_School)

### Деление - O(n*m)
- Fast-path для Int64
- Алгоритм Кнута (Algorithm D из TAOCP)
- Специальные случаи: деление на 0, Low(Int64) / -1

## Константы
```pascal
HexPrefix = '$';  // Стандартный префикс для hex
BinPrefix = '%';  // Стандартный префикс для bin
KARATSUBA_THRESHOLD = 32;  // Порог для алгоритма Карацубы
MIN_ALLOCATED_LIMBS = 4;   // Минимальный размер буфера
```

## Управление памятью
- Гибридная стратегия роста: x2 для < 256, x1.5 для больших
- EnsureCapacity для подготовки буфера
- ShrinkToFit для экономии памяти
- Порог сжатия: 16 разрядов

## Недавние изменения (2025-12-15)
- Добавлены централизованные helper-функции (IsSmallBigInt, IsZeroBigInt, EnsureCapacity, ShrinkToFit, AreSameAddress)
- Оптимизированы BigIntAdd, BigIntSub, BigIntMul, BigIntDivMod с использованием новых helper-функций
- Добавлена подробная документация на русском языке к основным алгоритмам
- Добавлены константы HexPrefix и BinPrefix
- Устранены все предупреждения компилятора
